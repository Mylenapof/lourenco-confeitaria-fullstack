<div class="encomendas-admin">
  <div class="page-header">
    <h1>Gerenciar Encomendas</h1>
    <div class="stats">
      <span class="stat">Total: {{ encomendas.length }}</span>
      <span class="stat">Pendentes: {{ getPendentes() }}</span>
    </div>
  </div>

  <div class="loading" *ngIf="loading">Carregando...</div>

  <div class="table-container" *ngIf="!loading">
    <table mat-table [dataSource]="encomendas" class="encomendas-table">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let encomenda">
          #{{ encomenda.id.substring(0, 8) }}
        </td>
      </ng-container>

      <!-- Cliente -->
      <ng-container matColumnDef="cliente">
        <th mat-header-cell *matHeaderCellDef>Cliente</th>
        <td mat-cell *matCellDef="let encomenda">
          <div class="cliente-info">
            <strong>{{ encomenda.usuario?.nome }}</strong>
            <small>{{ encomenda.usuario?.email }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Tipo -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let encomenda">
          {{ encomenda.tipoProduto }}
        </td>
      </ng-container>

      <!-- Data Entrega -->
      <ng-container matColumnDef="dataEntrega">
        <th mat-header-cell *matHeaderCellDef>Entrega</th>
        <td mat-cell *matCellDef="let encomenda">
          {{ encomenda.dataEntrega | date:'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let encomenda">
          <mat-chip [ngClass]="getStatusClass(encomenda.status)">
            {{ getStatusTexto(encomenda.status) }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Valor -->
      <ng-container matColumnDef="valor">
        <th mat-header-cell *matHeaderCellDef>Valor</th>
        <td mat-cell *matCellDef="let encomenda">
          <span *ngIf="encomenda.valorEstimado">
            R$ {{ encomenda.valorEstimado | number:'1.2-2' }}
          </span>
          <span *ngIf="!encomenda.valorEstimado">-</span>
        </td>
      </ng-container>

      <!-- Ações -->
      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let encomenda">
          <mat-select 
            [value]="encomenda.status"
            (selectionChange)="atualizarStatus(encomenda.id, $event.value)"
            class="status-select">
            <mat-option *ngFor="let status of statusOptions" [value]="status">
              {{ getStatusTexto(status) }}
            </mat-option>
          </mat-select>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="empty-state" *ngIf="!loading && encomendas.length === 0">
      <mat-icon>inbox</mat-icon>
      <h3>Nenhuma encomenda encontrada</h3>
    </div>
  </div>
</div>