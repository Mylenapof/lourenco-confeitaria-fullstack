<div class="encomendas-page">
  <div class="encomendas-header pink-gradient-bg">
    <div class="container">
      <h1>Faça sua Encomenda</h1>
      <p>Personalize seu pedido ou encomende centos de salgados</p>
    </div>
  </div>

  <div class="container">
    <div class="encomendas-content">

      <!-- ============================
           SELETOR DE TIPO
      ============================ -->
      <div class="tipo-selector">
        <button
          class="tipo-card"
          [class.active]="tipoSelecionado === 'personalizada'"
          (click)="tipoSelecionado = 'personalizada'"
        >
          <mat-icon>cake</mat-icon>
          <h3>Encomenda Personalizada</h3>
          <p>Bolos, tortas e doces especiais sob medida</p>
        </button>

        <button
          class="tipo-card"
          [class.active]="tipoSelecionado === 'salgados'"
          (click)="tipoSelecionado = 'salgados'"
        >
          <mat-icon>fastfood</mat-icon>
          <h3>Centos de Salgados</h3>
          <p>Salgados fritos e assados para eventos</p>
        </button>
      </div>

      <!-- ============================
           FORMULÁRIO PERSONALIZADO
      ============================ -->

      <div class="form-container" *ngIf="tipoSelecionado === 'personalizada'">
        <div class="form-card">
          <div class="form-header">
            <mat-icon>edit_note</mat-icon>
            <h2>Detalhes da Encomenda</h2>
          </div>

          <form [formGroup]="encomendaForm" (ngSubmit)="onSubmit()">
            
            <!-- Tipo de Produto -->
            <div class="form-group">
              <label>Tipo de Produto *</label>
              <mat-form-field appearance="outline">
                <mat-select formControlName="tipoProduto" placeholder="Selecione o tipo">
                  <mat-option *ngFor="let tipo of tiposProduto" [value]="tipo">
                    {{ tipo }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Tamanho -->
            <div class="form-group">
              <label>Tamanho</label>
              <mat-form-field appearance="outline">
                <mat-select formControlName="tamanho" placeholder="Selecione o tamanho">
                  <mat-option *ngFor="let tamanho of tamanhos" [value]="tamanho">
                    {{ tamanho }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Sabor -->
            <div class="form-group">
              <label>Sabor/Recheio</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="sabor" placeholder="Ex: Chocolate com morango" />
              </mat-form-field>
            </div>

            <!-- Decoração -->
            <div class="form-group">
              <label>Decoração/Tema</label>
              <mat-form-field appearance="outline">
                <textarea matInput rows="3" formControlName="decoracao"></textarea>
              </mat-form-field>
            </div>

            <!-- Observações -->
            <div class="form-group">
              <label>Observações Adicionais</label>
              <mat-form-field appearance="outline">
                <textarea matInput rows="4" formControlName="observacoes"></textarea>
              </mat-form-field>
            </div>

            <!-- Data de Entrega -->
            <div class="form-group">
              <label>Data de Entrega *</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  [matDatepicker]="picker"
                  formControlName="dataEntrega"
                  placeholder="Selecione uma data"
                />
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              <small class="help-text">Prazo mínimo: 3 dias úteis</small>
            </div>

            <button type="submit" class="btn-primary btn-block" [disabled]="loading">
              <mat-icon>send</mat-icon>
              {{ loading ? "Enviando..." : "Enviar Encomenda" }}
            </button>

          </form>
        </div>

        <!-- RESUMO PERSONALIZADA -->
        <div class="resumo-card">
          <h3>Resumo da Encomenda</h3>

          <div *ngIf="encomendaForm.get('tipoProduto')?.value">
            <p><strong>Tipo:</strong> {{ encomendaForm.get("tipoProduto")?.value }}</p>
          </div>

          <div *ngIf="encomendaForm.get('tamanho')?.value">
            <p><strong>Tamanho:</strong> {{ encomendaForm.get("tamanho")?.value }}</p>
          </div>

          <div *ngIf="encomendaForm.get('dataEntrega')?.value">
            <p><strong>Entrega:</strong> {{ encomendaForm.get("dataEntrega")?.value | date:'dd/MM/yyyy' }}</p>
          </div>

          <div class="resumo-empty" *ngIf="!encomendaForm.get('tipoProduto')?.value">
            <p>Preencha o formulário para ver o resumo</p>
          </div>
        </div>
      </div>

     <!-- ============================
     TELA DE CENTOS DE SALGADOS
=============================== -->
<div class="centos-grid" *ngIf="tipoSelecionado === 'salgados'">

  <!-- ================== CARD FRITOS ================== -->
  <div class="salgado-card">
    <h2>Salgados Fritos</h2>
    <p class="preco">R$ 85,00 por cento</p>

    <div class="counter">
      <button (click)="alterarQtd('fritos', -1)">-</button>
      <span>{{ centos.fritos }} cento(s)</span>
      <button (click)="alterarQtd('fritos', 1)">+</button>
    </div>

    <h4>Selecione os tipos (mínimo 2):</h4>
    <div class="sabor-list">
      <label *ngFor="let s of saboresFritos">
        <input type="checkbox" (change)="toggleSabor('fritos', s, $event)" />
        {{ s }}
      </label>
    </div>
  </div>

  <!-- ================== CARD ASSADOS ================== -->
  <div class="salgado-card">
    <h2>Salgados Assados</h2>
    <p class="preco">R$ 95,00 por cento</p>

    <div class="counter">
      <button (click)="alterarQtd('assados', -1)">-</button>
      <span>{{ centos.assados }} cento(s)</span>
      <button (click)="alterarQtd('assados', 1)">+</button>
    </div>

    <h4>Selecione os tipos (mínimo 2):</h4>
    <div class="sabor-list">
      <label *ngFor="let s of saboresAssados">
        <input type="checkbox" (change)="toggleSabor('assados', s, $event)" />
        {{ s }}
      </label>
    </div>
  </div>

  <!-- ================== CARD RESUMO (COLUNA DIREITA) ================== -->
  <div class="resumo-card">
    <h3>Resumo da Encomenda</h3>

    <p><strong>Fritos:</strong> {{ centos.fritos }} cento(s)</p>
    <p><strong>Assados:</strong> {{ centos.assados }} cento(s)</p>
    <p><strong>Total:</strong> {{ centos.fritos + centos.assados }} cento(s)</p>

    <p class="valor"><strong>Valor Estimado:</strong>  
      R$ {{ calcularValorTotal() | number:'1.2-2' }}
    </p>

    <mat-form-field appearance="outline">
      <input 
        matInput 
        [matDatepicker]="pickerS"
        placeholder="Data de entrega"
        (dateChange)="dataEntregaSalg = $event.value"
      />
      <mat-datepicker-toggle matSuffix [for]="pickerS"></mat-datepicker-toggle>
      <mat-datepicker #pickerS></mat-datepicker>
    </mat-form-field>

    <!-- CAMPO DE OBSERVAÇÕES -->
    <mat-form-field appearance="outline">
      <textarea 
        matInput 
        rows="3"
        placeholder="Observações adicionais"
        [(ngModel)]="obsSalgados">
      </textarea>
    </mat-form-field>

    <button class="btn-primary btn-block" (click)="onSubmit()">
      Enviar Encomenda
    </button>

    <small class="info">Entraremos em contato para confirmar.</small>
  </div>

</div>